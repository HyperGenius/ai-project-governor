# サブスクリプションと機能制限の仕様 (Subscription Specs)

## 概要
本サービスはテナント（組織）単位、およびユーザー単位での機能制限を行うSaaSモデルを採用する。
本ドキュメントでは、各プランにおける機能制限の技術的な仕様を定義する。

## プラン定義

### 1. Free Plan (Entry)
* **対象:** 個人開発者、お試し利用
* **制限ロジック:**
    * **日報丁寧度:** Lv.3（標準）まで選択可能。UI上でLv.4, 5を無効化する。
    * **週報生成:** 月2回まで。`weekly_summaries` テーブルの作成日時でカウントし、API側で制限をかける。
    * **プロジェクト数:** 1つのみ。`projects` テーブルへのInsert時に既存数をチェックする。

### 2. Pro Plan (Personal)
* **対象:** フリーランス、ヘビーユーザー
* **課金単位:** ユーザー課金 (Stripe Subscription)
* **解放機能:**
    * **丁寧度 Lv.5 (謝罪・役員向け):** プロンプト `PROMPTS_WITH_LEVEL_DESCRIPTION[5]` へのアクセス権限を付与。
    * **週報生成:** 無制限。
    * **工数分析:** 個人ダッシュボードでのグラフ表示機能を有効化。

### 3. Team Plan (Organization)
* **対象:** 5名以上のチーム
* **課金単位:** テナント課金 (Seat base)
* **解放機能:**
    * **チーム週報:** テナント内の全ユーザーの日報を集約するバッチ処理を実行可能にする。
    * **WBS自動生成:** プロジェクト作成時のAI生成機能を有効化。
    * **RLS:** `tenants` テーブルに基づくデータ分離を徹底する（基本実装済み）。

## 実装方針 (Implementation Strategy)

### DB設計
* `tenants` テーブルに `plan_tier` (enum: 'free', 'team', 'enterprise') カラムを追加する。
* `profiles` テーブルに `is_pro_user` (boolean) カラムを追加する、または `subscriptions` テーブルを別途作成して管理する。

### API制限 (FastAPI)
* `Dependency Injection` を使用して、リクエストユーザーのプラン情報を取得。
* 各エンドポイント（例: `/reports`）で、プランに応じたバリデーションロジックを挟む。
